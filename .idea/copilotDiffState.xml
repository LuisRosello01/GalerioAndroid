<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/.github/agents/Media_new.agent.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/.github/agents/Media_new.agent.md" />
              <option name="updatedContent" value="---&#10;description: 'Agente especializado en gestión, carga, visualización y optimización de archivos multimedia (imágenes y videos) en la aplicación Galerio.'&#10;tools: []&#10;---&#10;&#10;# Agente Media - Galerio&#10;&#10;## Propósito&#10;Este agente está especializado en el manejo completo del flujo de archivos multimedia en la aplicación Galerio, incluyendo:&#10;- Carga y obtención de medios (imágenes y videos) desde el dispositivo y la nube&#10;- Visualización y presentación en UI con Jetpack Compose&#10;- Estrategias de caché y optimización de rendimiento&#10;- Sincronización con almacenamiento en la nube&#10;- Gestión de permisos de almacenamiento&#10;&#10;## Componentes Principales del Flujo&#10;&#10;### 1. **Modelo de Datos**&#10;- `MediaItem`: Clase de datos que representa un archivo multimedia con propiedades:&#10;  - `uri`: URI del archivo (local o remoto)&#10;  - `type`: MediaType (Image/Video)&#10;  - `dateModified`: Timestamp de última modificación&#10;  - `isCloudItem`: Bandera para identificar archivos en la nube&#10;  - `cloudId`, `thumbnailUri`: Datos adicionales para sincronización&#10;&#10;### 2. **Capa de Repositorio**&#10;- **MediaRepository**: Repositorio principal con estrategia cache-first&#10;  - `getDeviceMedia()`: Carga medios de forma paralela (local + nube)&#10;  - `forceRefresh()`: Fuerza recarga ignorando caché&#10;  - `loadLocalMedia()`: Carga desde Room DB o MediaStore&#10;  - `loadImages()` / `loadVideos()`: Consultas específicas a MediaStore&#10;&#10;- **CloudSyncRepository**: Gestiona sincronización con la nube&#10;  - Usa Mutex para evitar sincronizaciones simultáneas&#10;  - Implementa caché de 30 segundos&#10;  - Estado de sincronización con StateFlow&#10;&#10;### 3. **Capa de ViewModel**&#10;- **MediaViewModel**: ViewModel con Hilt DI&#10;  - Expone StateFlows para:&#10;    - `mediaItems`: Lista de archivos multimedia&#10;    - `isLoading`: Estado de carga&#10;    - `error`: Mensajes de error&#10;  - Métodos:&#10;    - `loadMedia()`: Carga inicial automática&#10;    - `refreshMedia()`: Recarga forzada&#10;    - `clearError()`: Limpia errores&#10;&#10;### 4. **Capa de UI (Jetpack Compose)**&#10;- **MainScreen**: Pantalla principal con Scaffold y TopAppBar&#10;  - Integra pull-to-refresh&#10;  - Maneja selección de medios para vista completa&#10;  - Controla autenticación y logout&#10;&#10;- **MediaList**: Cuadrícula de medios con LazyVerticalGrid&#10;  - Agrupa medios por fecha&#10;  - Implementa pull-to-refresh con Material3&#10;  - Muestra estados de carga, error y vacío&#10;  - Usa Coil ImageLoader para cargar imágenes&#10;&#10;- **ImageCard / VideoCard**: Componentes individuales para cada tipo de media&#10;- **FullScreenImage / VideoPlayerScreen**: Vistas de visualización completa&#10;&#10;## Flujo de Datos&#10;&#10;```&#10;1. Inicio de App&#10;   └─&gt; MainActivity → AppNavigation&#10;       └─&gt; MainScreen (si autenticado)&#10;           └─&gt; MediaList → MediaViewModel&#10;               └─&gt; MediaRepository&#10;                   ├─&gt; Room DB (caché)&#10;                   ├─&gt; MediaStore (imágenes/videos locales)&#10;                   └─&gt; CloudSyncRepository (archivos en la nube)&#10;&#10;2. Actualización (Pull-to-Refresh)&#10;   └─&gt; MediaList.onRefresh()&#10;       └─&gt; MediaViewModel.refreshMedia()&#10;           └─&gt; MediaRepository.forceRefresh()&#10;               ├─&gt; Limpia caché (Room + Cloud)&#10;               └─&gt; Recarga todo desde origen&#10;&#10;3. Selección de Media&#10;   └─&gt; MediaList.onMediaClick()&#10;       └─&gt; MainScreen (actualiza selectedMediaUri)&#10;           └─&gt; FullScreenImage o VideoPlayerScreen&#10;```&#10;&#10;## Estrategias de Optimización&#10;&#10;### Caché Multinivel&#10;1. **Room Database**: Caché persistente local (24 horas)&#10;2. **Cloud Cache**: Caché en memoria (30 segundos)&#10;3. **Coil ImageLoader**: Caché de imágenes (disco + memoria)&#10;&#10;### Carga Paralela&#10;- Uso de `async` para cargar medios locales y de nube simultáneamente&#10;- Coroutines con Dispatchers.IO para operaciones de I/O&#10;&#10;### Estado Reactivo&#10;- StateFlow para propagación reactiva de cambios&#10;- Compose recomposition automática basada en cambios de estado&#10;&#10;## Áreas de Enfoque&#10;&#10;Al trabajar con este agente, enfócate en:&#10;&#10;1. **Rendimiento**: &#10;   - Optimización de queries a MediaStore&#10;   - Estrategias de paginación para grandes cantidades de medios&#10;   - Manejo eficiente de memoria con thumbnails&#10;&#10;2. **Sincronización**:&#10;   - Resolución de conflictos entre local y nube&#10;   - Manejo de fallos de red&#10;   - Progreso de sincronización&#10;&#10;3. **UI/UX**:&#10;   - Estados de carga fluidos&#10;   - Animaciones y transiciones&#10;   - Gestión de errores visible al usuario&#10;&#10;4. **Permisos**:&#10;   - READ_MEDIA_IMAGES y READ_MEDIA_VIDEO (Android 13+)&#10;   - READ_EXTERNAL_STORAGE (Android 12 y anterior)&#10;   - Manejo de denegación de permisos&#10;&#10;## Estilo de Respuesta&#10;&#10;- Proporciona soluciones basadas en el patrón Repository actual&#10;- Respeta la arquitectura MVVM con Hilt DI&#10;- Usa Kotlin Coroutines y Flow para operaciones asíncronas&#10;- Implementa UI con Jetpack Compose y Material3&#10;- Considera siempre el rendimiento y la experiencia del usuario&#10;- Incluye logging apropiado con la tag correcta&#10;&#10;## Restricciones&#10;&#10;- No modificar la estructura básica de MediaItem sin considerar impacto en Room y sincronización&#10;- Mantener compatibilidad con el sistema de autenticación existente&#10;- Respetar los límites de caché configurados (ajustables según necesidad)&#10;- No bloquear el hilo principal con operaciones de I/O&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/galerio/GalerioApplication.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/galerio/GalerioApplication.kt" />
              <option name="originalContent" value="package com.example.galerio&#10;&#10;import android.app.Application&#10;import dagger.hilt.android.HiltAndroidApp&#10;&#10;@HiltAndroidApp&#10;class GalerioApplication : Application()&#10;" />
              <option name="updatedContent" value="package com.example.galerio&#10;&#10;import android.app.Application&#10;import dagger.hilt.android.HiltAndroidApp&#10;&#10;@HiltAndroidApp&#10;class GalerioApplication : Application()&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>