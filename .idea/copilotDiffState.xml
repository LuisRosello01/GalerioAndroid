<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/galerio/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/galerio/MainActivity.kt" />
              <option name="originalContent" value="package com.example.galerio&#10;&#10;import android.net.Uri&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Surface&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavType&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.rememberNavController&#10;import androidx.navigation.navArgument&#10;import com.example.galerio.ui.MainScreen&#10;import com.example.galerio.ui.VideoPlayerScreen&#10;&#10;class MainActivity : ComponentActivity() {&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        //setContentView(R.layout.activity_main)&#10;&#10;        setContent {&#10;            Surface(&#10;                modifier= Modifier.fillMaxSize(),&#10;                color = MaterialTheme.colorScheme.background&#10;            ) {&#10;                AppNavigation()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;&#10;    NavHost(navController, startDestination = &quot;media_list&quot;) {&#10;        composable(&quot;media_list&quot;) {&#10;            MainScreen(context = LocalContext.current) { videoUri -&gt;&#10;                navController.navigate(&quot;video_player?uri=$videoUri&quot;)&#10;            }&#10;        }&#10;&#10;        composable(&#10;            &quot;video_player?uri={uri}&quot;,&#10;            arguments = listOf(navArgument(&quot;uri&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val uri = Uri.parse(backStackEntry.arguments?.getString(&quot;uri&quot;))&#10;            VideoPlayerScreen(videoUri = uri) {&#10;                navController.popBackStack()&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.galerio&#10;&#10;import android.net.Uri&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Surface&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.navigation.NavType&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.rememberNavController&#10;import androidx.navigation.navArgument&#10;import com.example.galerio.ui.MainScreen&#10;import com.example.galerio.ui.VideoPlayerScreen&#10;&#10;class MainActivity : ComponentActivity() {&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        //setContentView(R.layout.activity_main)&#10;&#10;        setContent {&#10;            Surface(&#10;                modifier= Modifier.fillMaxSize(),&#10;                color = MaterialTheme.colorScheme.background&#10;            ) {&#10;                AppNavigation()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;&#10;    NavHost(navController, startDestination = &quot;media_list&quot;) {&#10;        composable(&quot;media_list&quot;) {&#10;            MainScreen { videoUri -&gt;&#10;                navController.navigate(&quot;video_player?uri=$videoUri&quot;)&#10;            }&#10;        }&#10;&#10;        composable(&#10;            &quot;video_player?uri={uri}&quot;,&#10;            arguments = listOf(navArgument(&quot;uri&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val uri = Uri.parse(backStackEntry.arguments?.getString(&quot;uri&quot;))&#10;            VideoPlayerScreen(videoUri = uri) {&#10;                navController.popBackStack()&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/galerio/ui/MainScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/galerio/ui/MainScreen.kt" />
              <option name="originalContent" value="package com.example.galerio.ui&#10;&#10;import android.content.Context&#10;import android.net.Uri&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.runtime.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.input.nestedscroll.nestedScroll&#10;import androidx.compose.ui.zIndex&#10;import com.example.galerio.data.model.MediaType&#10;import com.example.galerio.permissions.RequestMediaPermissions&#10;&#10;// Función para mostrar la pantalla principal&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MainScreen(context: Context, onVideoClick: (Uri) -&gt; Unit) {&#10;    var selectedMediaUri by remember { mutableStateOf&lt;Uri?&gt;(null) } // Estado para la selección de medios&#10;    var isVideoSelected by remember { mutableStateOf(false) } // Estado para saber si se seleccionó un video&#10;&#10;    val scrollBehavior = TopAppBarDefaults.pinnedScrollBehavior() // Manejo de desplazamiento para la barra de aplicación&#10;&#10;    Scaffold(&#10;        topBar = { MyAppBar(scrollBehavior) },&#10;        modifier = Modifier.nestedScroll(scrollBehavior.nestedScrollConnection)&#10;    ) { paddingValues -&gt;&#10;        RequestMediaPermissions {&#10;                // Lista de medios (fondo)&#10;                MediaList(&#10;                    modifier = Modifier.padding(paddingValues),&#10;                    context = context&#10;                ) { uri, isVideo -&gt;&#10;                    selectedMediaUri = uri&#10;                    isVideoSelected = isVideo == MediaType.Video&#10;                }&#10;                // Si hay una imagen o video seleccionado, lo mostramos superpuesto&#10;                selectedMediaUri?.let { uri -&gt;&#10;                    Box(modifier = Modifier.zIndex(1f)) {&#10;                    if (isVideoSelected) {&#10;                        VideoPlayerScreen(videoUri = uri) {&#10;                            selectedMediaUri = null // Cerrar el video y volver a la lista&#10;                        }&#10;                    } else {&#10;                        FullScreenImage(imageUri = uri) {&#10;                            selectedMediaUri = null // Cerrar la imagen y volver a la lista&#10;                        }&#10;                }}&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Función para mostrar la barra de aplicación&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MyAppBar(scrollBehavior: TopAppBarScrollBehavior) {&#10;    TopAppBar(&#10;        title = { Text(&quot;Galerio&quot;) },&#10;        actions = {&#10;            IconButton(onClick = {&#10;                /*TODO*/&#10;            }) {&#10;                Icon(Icons.Filled.MoreVert, contentDescription = &quot;More&quot;)&#10;            }&#10;        },&#10;        scrollBehavior = scrollBehavior&#10;    )&#10;}" />
              <option name="updatedContent" value="package com.example.galerio.ui&#10;&#10;import android.net.Uri&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.runtime.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.input.nestedscroll.nestedScroll&#10;import androidx.compose.ui.zIndex&#10;import com.example.galerio.data.model.MediaType&#10;import com.example.galerio.permissions.RequestMediaPermissions&#10;&#10;// Función para mostrar la pantalla principal&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MainScreen(onVideoClick: (Uri) -&gt; Unit) {&#10;    var selectedMediaUri by remember { mutableStateOf&lt;Uri?&gt;(null) } // Estado para la selección de medios&#10;    var isVideoSelected by remember { mutableStateOf(false) } // Estado para saber si se seleccionó un video&#10;&#10;    val scrollBehavior = TopAppBarDefaults.pinnedScrollBehavior() // Manejo de desplazamiento para la barra de aplicación&#10;&#10;    Scaffold(&#10;        topBar = { MyAppBar(scrollBehavior) },&#10;        modifier = Modifier.nestedScroll(scrollBehavior.nestedScrollConnection)&#10;    ) { paddingValues -&gt;&#10;        RequestMediaPermissions {&#10;            // Lista de medios (fondo)&#10;            MediaList(&#10;                modifier = Modifier.padding(paddingValues)&#10;            ) { uri, mediaType -&gt;&#10;                selectedMediaUri = uri&#10;                isVideoSelected = mediaType == MediaType.Video&#10;            }&#10;            // Si hay una imagen o video seleccionado, lo mostramos superpuesto&#10;            selectedMediaUri?.let { uri -&gt;&#10;                Box(modifier = Modifier.zIndex(1f)) {&#10;                    if (isVideoSelected) {&#10;                        VideoPlayerScreen(videoUri = uri) {&#10;                            selectedMediaUri = null // Cerrar el video y volver a la lista&#10;                        }&#10;                    } else {&#10;                        FullScreenImage(imageUri = uri) {&#10;                            selectedMediaUri = null // Cerrar la imagen y volver a la lista&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Función para mostrar la barra de aplicación&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MyAppBar(scrollBehavior: TopAppBarScrollBehavior) {&#10;    TopAppBar(&#10;        title = { Text(&quot;Galerio&quot;) },&#10;        actions = {&#10;            IconButton(onClick = {&#10;                /*TODO*/&#10;            }) {&#10;                Icon(Icons.Filled.MoreVert, contentDescription = &quot;More&quot;)&#10;            }&#10;        },&#10;        scrollBehavior = scrollBehavior&#10;    )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/galerio/ui/MediaList.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/galerio/ui/MediaList.kt" />
              <option name="originalContent" value="package com.example.galerio.ui&#10;&#10;import android.content.Context&#10;import android.net.Uri&#10;import android.util.Log&#10;import androidx.compose.foundation.gestures.snapping.SnapPosition&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.GridItemSpan&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import com.example.galerio.data.model.MediaItem&#10;import com.example.galerio.data.model.MediaType&#10;import com.example.galerio.ui.components.ImageCard&#10;import com.example.galerio.ui.components.VideoCard&#10;import com.example.galerio.utils.MediaUtils.getDeviceMedia&#10;import kotlinx.coroutines.launch&#10;import java.time.Instant&#10;import java.time.ZoneId&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Date&#10;import java.util.Locale&#10;&#10;// Función para mostrar la lista de imágenes en una cuadrícula&#10;@Composable&#10;fun MediaList(modifier: Modifier, context: Context, onMediaClick: (Uri, MediaType) -&gt; Unit) {&#10;    // Use remember to avoid recomputing the list unnecessarily&#10;    var mediaItems by remember { mutableStateOf(emptyList&lt;MediaItem&gt;()) }&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    LaunchedEffect(Unit) {&#10;        coroutineScope.launch {&#10;            val items = getDeviceMedia(context) // Should be run in a background thread&#10;            mediaItems = items&#10;            Log.d(&quot;MediaList&quot;, &quot;Media items loaded: $mediaItems&quot;)&#10;        }&#10;    }&#10;&#10;    // Agrupamos por fecha (utilizando la fecha tomada del media)&#10;    val formatter = remember { DateTimeFormatter.ofPattern(&quot;EEE, d MMM&quot;, Locale.getDefault()) }&#10;    val groupedMediaItems = mediaItems.groupBy { mediaItem -&gt;&#10;        val timestampInMillis = mediaItem.dateModified * 1000 // Convertir segundos a milisegundos&#10;&#10;        // Convertir el timestamp a una fecha formateada&#10;        Instant.ofEpochMilli(timestampInMillis)&#10;            .atZone(ZoneId.systemDefault())&#10;            .toLocalDate()&#10;            .format(formatter)&#10;    }&#10;&#10;    if (groupedMediaItems.isEmpty()) {&#10;        Box(modifier = Modifier.fillMaxSize()) {&#10;            Text(&#10;                text = &quot;No media found&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                modifier = Modifier.align(Alignment.Center),&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;    else (&#10;        LazyVerticalGrid(&#10;            columns = GridCells.Fixed(3),&#10;            modifier = modifier.fillMaxSize()&#10;        ) {&#10;            groupedMediaItems.forEach { (date, mediaForDate) -&gt;&#10;                // StickyHeader o cabecera&#10;                item(span = { GridItemSpan(maxLineSpan) }) {&#10;                    Text(&#10;                        text = date,&#10;                        style = MaterialTheme.typography.titleLarge,&#10;                        modifier = Modifier.padding(8.dp)&#10;                    )&#10;                }&#10;&#10;                items(mediaForDate.sortedByDescending { it.dateModified }) { mediaItem -&gt;&#10;                    when (mediaItem.type) {&#10;                        MediaType.Image -&gt; ImageCard(imageUri = mediaItem.uri, context = context,&#10;                            onClick = { onMediaClick(mediaItem.uri, mediaItem.type) })&#10;&#10;                        MediaType.Video -&gt; VideoCard(videoUri = mediaItem.uri,&#10;                            duration = mediaItem.duration,&#10;                            context = context,&#10;                            onClick = { onMediaClick(mediaItem.uri, mediaItem.type) })&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    )&#10;}" />
              <option name="updatedContent" value="package com.example.galerio.ui&#10;&#10;import android.net.Uri&#10;import android.util.Log&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.lazy.grid.GridCells&#10;import androidx.compose.foundation.lazy.grid.GridItemSpan&#10;import androidx.compose.foundation.lazy.grid.LazyVerticalGrid&#10;import androidx.compose.foundation.lazy.grid.items&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.galerio.data.model.MediaType&#10;import com.example.galerio.ui.components.ImageCard&#10;import com.example.galerio.ui.components.VideoCard&#10;import com.example.galerio.viewmodel.MediaViewModel&#10;import java.time.Instant&#10;import java.time.ZoneId&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Locale&#10;&#10;// Función para mostrar la lista de imágenes en una cuadrícula&#10;@Composable&#10;fun MediaList(modifier: Modifier, onMediaClick: (Uri, MediaType) -&gt; Unit) {&#10;    val viewModel: MediaViewModel = viewModel()&#10;    val mediaItems by viewModel.mediaItems.collectAsState()&#10;    val isLoading by viewModel.isLoading.collectAsState()&#10;    val context = LocalContext.current&#10;&#10;    if (isLoading) {&#10;        Box(modifier = Modifier.fillMaxSize()) {&#10;            CircularProgressIndicator(modifier = Modifier.align(Alignment.Center))&#10;        }&#10;        return&#10;    }&#10;&#10;    // Agrupamos por fecha (utilizando la fecha tomada del media)&#10;    val formatter = remember { DateTimeFormatter.ofPattern(&quot;EEE, d MMM&quot;, Locale.getDefault()) }&#10;    val groupedMediaItems = mediaItems.groupBy { mediaItem -&gt;&#10;        val timestampInMillis = mediaItem.dateModified * 1000 // Convertir segundos a milisegundos&#10;&#10;        // Convertir el timestamp a una fecha formateada&#10;        Instant.ofEpochMilli(timestampInMillis)&#10;            .atZone(ZoneId.systemDefault())&#10;            .toLocalDate()&#10;            .format(formatter)&#10;    }&#10;&#10;    if (groupedMediaItems.isEmpty()) {&#10;        Box(modifier = Modifier.fillMaxSize()) {&#10;            Text(&#10;                text = &quot;No media found&quot;,&#10;                style = MaterialTheme.typography.titleLarge,&#10;                modifier = Modifier.align(Alignment.Center),&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;    else {&#10;        LazyVerticalGrid(&#10;            columns = GridCells.Fixed(3),&#10;            modifier = modifier.fillMaxSize()&#10;        ) {&#10;            groupedMediaItems.forEach { (date, mediaForDate) -&gt;&#10;                // StickyHeader o cabecera&#10;                item(span = { GridItemSpan(maxLineSpan) }) {&#10;                    Text(&#10;                        text = date,&#10;                        style = MaterialTheme.typography.titleLarge,&#10;                        modifier = Modifier.padding(8.dp)&#10;                    )&#10;                }&#10;&#10;                items(mediaForDate.sortedByDescending { it.dateModified }) { mediaItem -&gt;&#10;                    when (mediaItem.type) {&#10;                        MediaType.Image -&gt; ImageCard(imageUri = mediaItem.uri, context = context,&#10;                            onClick = { onMediaClick(mediaItem.uri, mediaItem.type) })&#10;&#10;                        MediaType.Video -&gt; VideoCard(videoUri = mediaItem.uri,&#10;                            duration = mediaItem.duration,&#10;                            context = context,&#10;                            onClick = { onMediaClick(mediaItem.uri, mediaItem.type) })&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/galerio/viewmodel/MediaViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/galerio/viewmodel/MediaViewModel.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.example.galerio.viewmodel&#10;&#10;import android.app.Application&#10;import android.util.Log&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.galerio.data.model.MediaItem&#10;import com.example.galerio.utils.MediaUtils&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;class MediaViewModel(application: Application) : AndroidViewModel(application) {&#10;    &#10;    private val _mediaItems = MutableStateFlow&lt;List&lt;MediaItem&gt;&gt;(emptyList())&#10;    val mediaItems: StateFlow&lt;List&lt;MediaItem&gt;&gt; = _mediaItems.asStateFlow()&#10;    &#10;    private val _isLoading = MutableStateFlow(true)&#10;    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading.asStateFlow()&#10;    &#10;    init {&#10;        loadMedia()&#10;    }&#10;    &#10;    private fun loadMedia() {&#10;        viewModelScope.launch(Dispatchers.IO) {&#10;            _isLoading.value = true&#10;            try {&#10;                val items = MediaUtils.getDeviceMedia(getApplication())&#10;                _mediaItems.value = items&#10;                Log.d(&quot;MediaViewModel&quot;, &quot;Loaded ${items.size} media items&quot;)&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;MediaViewModel&quot;, &quot;Error loading media&quot;, e)&#10;                _mediaItems.value = emptyList()&#10;            } finally {&#10;                _isLoading.value = false&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun refreshMedia() {&#10;        Log.d(&quot;MediaViewModel&quot;, &quot;Refreshing media&quot;)&#10;        loadMedia()&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>